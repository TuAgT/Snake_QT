# 贪吃蛇游戏自动构建工作流
# 此工作流会在每次推送到main分支或创建pull request时触发
name: Build

# 定义触发事件：当推送到main分支或创建pull request时
on:
  push:
    branches: [ main ]  # 监听main分支的推送
  pull_request:
    branches: [ main ]  # 监听针对main分支的pull request

jobs:
  # 构建任务
  build:
    # 在多种操作系统上运行（矩阵策略）
    runs-on: ${{ matrix.os }}
    strategy:
      # 定义矩阵策略，使工作流能在多个平台上运行
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    steps:
    # 第一步：检出代码
    - uses: actions/checkout@v4

    # 第二步：在Ubuntu上安装Qt
    - name: Install Qt (Ubuntu)
      if: runner.os == 'Linux'  # 仅在Linux运行器上执行
      uses: jurplel/install-qt-action@v3
      with:
        version: '6.6.0'    # Qt版本
        host: 'linux'         # 主机系统类型
        target: 'desktop'     # 目标平台
        arch: 'gcc_64'        # 架构类型
        dir: '${{ github.workspace }}/qt'  # 安装目录

    # 第三步：在Windows上安装Qt
    - name: Install Qt (Windows)
      if: runner.os == 'Windows'  # 仅在Windows运行器上执行
      uses: jurplel/install-qt-action@v3
      with:
        version: '6.6.0'    # Qt版本
        host: 'windows'       # 主机系统类型
        target: 'desktop'     # 目标平台
        arch: 'win64_msvc2019_64'  # 架构类型
        dir: '${{ github.workspace }}/qt'  # 安装目录

    # 第四步：在macOS上安装Qt
    - name: Install Qt (macOS)
      if: runner.os == 'macOS'  # 仅在macOS运行器上执行
      uses: jurplel/install-qt-action@v3
      with:
        version: '6.6.0'    # Qt版本
        host: 'mac'           # 主机系统类型
        target: 'desktop'     # 目标平台
        arch: 'clang_64'      # 架构类型
        dir: '${{ github.workspace }}/qt'  # 安装目录

    # 第五步：配置CMake（Linux/macOS）
    - name: Configure CMake (Linux/macOS)
      if: runner.os != 'Windows'  # 仅在非Windows运行器上执行
      run: cmake -B ${{ github.workspace }}/build -DCMAKE_BUILD_TYPE=Release

    # 第六步：配置CMake（Windows）
    - name: Configure CMake (Windows)
      if: runner.os == 'Windows'  # 仅在Windows运行器上执行
      run: cmake -B ${{ github.workspace }}/build -DCMAKE_BUILD_TYPE=Release

    # 第七步：构建项目
    - name: Build
      run: cmake --build ${{ github.workspace }}/build --config Release

    # 第八步：上传Linux构建产物
    - name: Upload Artifacts (Linux)
      if: runner.os == 'Linux'  # 仅在Linux运行器上执行
      uses: actions/upload-artifact@v4
      with:
        name: Snake-Game-Linux  # 构件名称
        path: ${{ github.workspace }}/build/QTGuiDemo  # 要上传的文件路径

    # 第九步：上传Windows构建产物
    - name: Upload Artifacts (Windows)
      if: runner.os == 'Windows'  # 仅在Windows运行器上执行
      uses: actions/upload-artifact@v4
      with:
        name: Snake-Game-Windows  # 构件名称
        path: ${{ github.workspace }}/build/Release/QTGuiDemo.exe  # 要上传的文件路径

    # 第十步：上传macOS构建产物
    - name: Upload Artifacts (macOS)
      if: runner.os == 'macOS'  # 仅在macOS运行器上执行
      uses: actions/upload-artifact@v4
      with:
        name: Snake-Game-macOS  # 构件名称
        path: ${{ github.workspace }}/build/QTGuiDemo  # 要上传的文件路径